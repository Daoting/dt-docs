<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>总体架构 - 搬运工</title>
        <meta name="Description" content="利用 C# &#43; XAML 进行快速业务开发的跨平台框架">
        <meta name="application-name" content="搬运工">
        <meta name="apple-mobile-web-app-title" content="搬运工">
        <meta name="theme-color" content="#ffffff">
        <meta name="msapplication-TileColor" content="#da532c">
        <link rel="shortcut icon" type="image/x-icon" href="/dt-docs/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/dt-docs/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/dt-docs/favicon-16x16.png">
        <link rel="apple-touch-icon" sizes="180x180" href="/dt-docs/apple-touch-icon.png">
        <link rel="mask-icon" href="/dt-docs/safari-pinned-tab.svg" color="#5bbad5">
        <link rel="manifest" href="/dt-docs/site.webmanifest">
        <link rel="canonical" href="https://daotingh.gitee.io/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/" />
        <link rel="alternate" href="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/index.xml" type="application/rss+xml" title="搬运工">
        <link rel="feed" href="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/index.xml" type="application/rss+xml" title="搬运工"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/dt-docs/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css">
    </head>
    <body data-header-desktop="fixed" data-header-mobile="auto">
        <script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>
        <div id="mask"></div>
        <div class="wrapper">
            <header class="desktop" id="header-desktop">
                <div class="header-wrapper">
                    <div class="header-title">
                        <a href="/dt-docs/" title="搬运工"><img class="lazyload logo" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/favicon-32x32.png" data-srcset="/dt-docs/favicon-32x32.png, /dt-docs/favicon-32x32.png 1.5x, /dt-docs/favicon-32x32.png 2x" data-sizes="auto" alt="/dt-docs/favicon-32x32.png" title="/dt-docs/favicon-32x32.png" />搬运工</a>
                    </div>
                    <div class="menu">
                        <div class="menu-inner"><a class="menu-item" href="/dt-docs/posts/"> 文章 </a><a class="menu-item" href="/dt-docs/docs/"> 教程 </a><a class="menu-item" href="https://github.com/daoting/dt" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i>  </a><span class="menu-item delimiter"></span>
                            <span class="menu-item search" id="search-desktop">
                                <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                                <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                                    <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                                </a>
                                <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                                    <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                                </a>
                                <span class="search-button search-loading" id="search-loading-desktop">
                                    <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                                </span>
                            </span>
                            <a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </header>
            <header class="mobile" id="header-mobile">
                <div class="header-container">
                    <div class="header-wrapper">
                        <div class="header-title">
                            <a href="/dt-docs/" title="搬运工"><img class="lazyload logo" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/favicon-32x32.png" data-srcset="/dt-docs/favicon-32x32.png, /dt-docs/favicon-32x32.png 1.5x, /dt-docs/favicon-32x32.png 2x" data-sizes="auto" alt="/dt-docs/favicon-32x32.png" title="/dt-docs/favicon-32x32.png" />搬运工</a>
                        </div>
                        <div class="menu-toggle" id="menu-toggle-mobile">
                            <span></span><span></span><span></span>
                        </div>
                    </div>
                    <div class="menu" id="menu-mobile">
                        <div class="search-wrapper">
                            <div class="search mobile" id="search-mobile">
                                <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                                <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                                    <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                                </a>
                                <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                                    <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                                </a>
                                <span class="search-button search-loading" id="search-loading-mobile">
                                    <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                                </span>
                            </div>
                            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                                取消
                            </a>
                        </div>
                        <a class="menu-item" href="/dt-docs/posts/" title="">文章</a>
                        <a class="menu-item" href="/dt-docs/docs/" title="">教程</a>
                        <a class="menu-item" href="https://github.com/daoting/dt" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i></a>
                        <a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                            <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                        </a>
                    </div>
                </div>
            </header>
            <div class="search-dropdown desktop">
                <div id="search-dropdown-desktop"></div>
            </div>
            <div class="search-dropdown mobile">
                <div id="search-dropdown-mobile"></div>
            </div>
            <main class="main"><div class="doc-frame">
    <aside class="doc-tree">
        <div id="content-mobile">
  <button class="fas fa-bars" type="button" onclick="var nav = document.getElementById('td-section-nav'); nav.style.display = (nav.style.display == 'block') ? 'none' : 'block' ">
  </button>
</div>
<nav class="td-sidebar-nav" id="td-section-nav">
  <ul class="td-sidebar-nav__section">
    <li>
  <a href="/dt-docs/docs/" title="概述" class="td-sidebar-link tree-root"><span>概述</span></a>
  <ul  class="ul-1" >
    <li>
  <a href="/dt-docs/docs/1%E5%BC%80%E5%A7%8B/" title="开始" class="td-sidebar-link"><span>开始</span></a>
  <ul >
    <li>
  <a href="/dt-docs/docs/1%E5%BC%80%E5%A7%8B/1%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/" title="开发环境" class="td-sidebar-link"><span>开发环境</span></a>
</li><li>
  <a href="/dt-docs/docs/1%E5%BC%80%E5%A7%8B/2%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE/" title="创建空项目" class="td-sidebar-link"><span>创建空项目</span></a>
</li><li>
  <a href="/dt-docs/docs/1%E5%BC%80%E5%A7%8B/3%E5%B0%8F%E8%AF%95%E7%89%9B%E5%88%80/" title="小试牛刀" class="td-sidebar-link"><span>小试牛刀</span></a>
</li><li>
  <a href="/dt-docs/docs/1%E5%BC%80%E5%A7%8B/4%E6%90%AC%E8%BF%90%E5%B7%A5%E6%A0%B7%E4%BE%8B/" title="搬运工样例" class="td-sidebar-link"><span>搬运工样例</span></a>
</li>
  </ul>
</li><li>
  <a href="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/" title="基础" class="td-sidebar-link"><span>基础</span></a>
  <ul >
    <li>
  <a href="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/" title="总体架构" class="td-sidebar-link active"><span>总体架构</span></a>
</li><li>
  <a href="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/2%E5%9F%BA%E7%A1%80%E5%8A%9F%E8%83%BD/" title="基础功能" class="td-sidebar-link"><span>基础功能</span></a>
</li><li>
  <a href="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/3%E9%A2%86%E5%9F%9F%E5%B1%82/" title="领域层" class="td-sidebar-link"><span>领域层</span></a>
</li><li>
  <a href="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/4%E6%9C%8D%E5%8A%A1/" title="服务" class="td-sidebar-link"><span>服务</span></a>
</li>
  </ul>
</li><li>
  <a href="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/" title="客户端" class="td-sidebar-link"><span>客户端</span></a>
  <ul >
    <li>
  <a href="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/" title="基础" class="td-sidebar-link"><span>基础</span></a>
</li><li>
  <a href="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/2%E7%95%8C%E9%9D%A2%E6%A1%86%E6%9E%B6/" title="界面框架" class="td-sidebar-link"><span>界面框架</span></a>
</li><li>
  <a href="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/3fv/" title="Fv" class="td-sidebar-link"><span>Fv</span></a>
</li><li>
  <a href="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/4lv/" title="Lv" class="td-sidebar-link"><span>Lv</span></a>
</li><li>
  <a href="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/5tab/" title="Tab" class="td-sidebar-link"><span>Tab</span></a>
</li><li>
  <a href="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/6%E5%9F%BA%E7%A1%80%E6%8E%A7%E4%BB%B6/" title="基础控件" class="td-sidebar-link"><span>基础控件</span></a>
</li>
  </ul>
</li><li>
  <a href="/dt-docs/docs/4%E5%8F%91%E5%B8%83%E9%83%A8%E7%BD%B2/" title="发布部署" class="td-sidebar-link"><span>发布部署</span></a>
  <ul >
    <li>
  <a href="/dt-docs/docs/4%E5%8F%91%E5%B8%83%E9%83%A8%E7%BD%B2/1%E6%9C%8D%E5%8A%A1/" title="服务" class="td-sidebar-link"><span>服务</span></a>
</li><li>
  <a href="/dt-docs/docs/4%E5%8F%91%E5%B8%83%E9%83%A8%E7%BD%B2/2win%E5%BA%94%E7%94%A8/" title="Win应用" class="td-sidebar-link"><span>Win应用</span></a>
</li><li>
  <a href="/dt-docs/docs/4%E5%8F%91%E5%B8%83%E9%83%A8%E7%BD%B2/3android%E5%BA%94%E7%94%A8/" title="Android应用" class="td-sidebar-link"><span>Android应用</span></a>
</li><li>
  <a href="/dt-docs/docs/4%E5%8F%91%E5%B8%83%E9%83%A8%E7%BD%B2/4ios%E5%BA%94%E7%94%A8/" title="iOS应用" class="td-sidebar-link"><span>iOS应用</span></a>
</li><li>
  <a href="/dt-docs/docs/4%E5%8F%91%E5%B8%83%E9%83%A8%E7%BD%B2/5wasm%E5%BA%94%E7%94%A8/" title="Wasm应用" class="td-sidebar-link"><span>Wasm应用</span></a>
</li>
  </ul>
</li>
  </ul>
</li>
  </ul>
</nav>


    </aside>
    <div class="doc-main">
        <div class="container">
            <article class="page single"><h1 class="single-title animate__animated animate__flipInX">总体架构</h1><div class="post-meta">
                    <div class="post-meta-line">
                        <i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;约 4628 字&nbsp;
                        <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;预计阅读 10 分钟&nbsp;</div>
                </div><div class="content" id="content"><h2 id="常见服务架构">常见服务架构</h2>
<ol>
<li>
<p>领域驱动设计：DDD(Domain Driven Design)领域驱动设计，作为一种软件建模方法，通过其自有的原则与套路来解决软件的复杂性问题，DDD设计的目的是使得业务能够从技术中分离并突显出来，让代码直接表达业务内容，其中包含了聚合根、领域服务、实体、值对象、仓库、工厂等概念。
<img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/1.png" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/1.png, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/1.png 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/1.png 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/1.png" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/1.png" width="598" height="666" /></p>
</li>
<li>
<p>命令查询职责分离：CQRS(Command Query Responsibility Segregation)命令查询职责分离，就是读写分离，读写分离的主要目的是为了提高查询性能，同时达到读、写解耦。而DDD和CQRS结合，可以分别对读和写建模。
<img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/2.jpg" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/2.jpg, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/2.jpg 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/2.jpg 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/2.jpg" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/2.jpg" width="512" height="462" /></p>
</li>
<li>
<p>六边形架构：又名端口适配器架构，它的核心理念是：应用是通过端口与外部进行交互的，这也是微服务架构下API网关盛行的主要原因。六边形架构中，内部业务逻辑（应用层和领域模型）与外部资源（APP，WEB应用以及数据库资源等）完全隔离，仅通过适配器进行交互。它解决了业务逻辑与用户界面的代码交错的主要问题，从而可以很好的实现前后端分离。
<img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/3.png" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/3.png, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/3.png 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/3.png 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/3.png" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/3.png" width="917" height="760" /></p>
</li>
<li>
<p>整洁架构：又名洋葱架构，同心圆代表应用软件的不同部分，从里到外依次是领域模型、领域服务、应用服务、最外围是容易变化的内容，如界面和基础设施（如数据存储等）。整洁架构是以领域模型为中心，不是以数据为中心。
<img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/4.jpg" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/4.jpg, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/4.jpg 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/4.jpg 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/4.jpg" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/4.jpg" width="772" height="567" /></p>
</li>
</ol>
<p><div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw" aria-hidden="true"></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">虽然整洁架构、六边形架构以及DDD分层架构三种架构模型展现方式以及解决问题的出发点不一样，但其架构思想与微服务架构高内聚低耦合的设计原则高度一致。</div>
        </div>
    </div>
<img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/5.png" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/5.png, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/5.png 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/5.png 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/5.png" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/5.png" width="752" height="480" /></p>
<h2 id="总体架构">总体架构</h2>
<p>本系统未严格按照以上某种具体的服务架构进行设计，而是根据自身整体架构的特点，借鉴以上各架构的思想，比如DDD模式的领域事件、充血模式、领域服务，CQRS架构的读写分离，六边形架构的微服务API设计等，结合客户端xaml的优势，使用MVVM(Model-View-ViewModel)模式开发客户端控件，<strong>实现客户端领域层和服务端领域层代码相同</strong>，既可以将业务放在客户端处理也可以稍加修改放在服务端处理，完美实现技术与业务解耦、业务逻辑解耦、业务封装复用等关键功能，为开发人员提供一种易懂易用的框架风格。总体框架图：
<figure><a class="lightgallery" href="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/6.png" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/6.png" data-thumbnail="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/6.png" data-sub-html="<h2>总体架构</h2>">
        <img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/6.png" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/6.png, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/6.png 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/6.png 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/6.png" width="988" height="1389" />
    </a><figcaption class="image-caption">总体架构</figcaption>
    </figure></p>
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw" aria-hidden="true"></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">目前平台只支持所有微服务连接同一RabbitMq、同一Redis，但每个微服务可以连接不同的数据库，详细配置参见<a href="/dt-docs/docs/2%e5%9f%ba%e7%a1%80/4%e6%9c%8d%e5%8a%a1/" rel="">服务配置</a>。</div>
        </div>
    </div>
<h2 id="客户端">客户端</h2>
<h3 id="view层">View层</h3>
<p>客户端采用<code>MVVM</code>模式，属于富客户端，支持App和Web，可以看作单页模式的UI，常用的xaml控件Lv Fv Tv FileList等请参见<a href="" rel="">常用控件</a>。</p>
<h3 id="viewmodel层">ViewModel层</h3>
<p>View层的这些控件都支持多种数据源类型，如Fv支持普通对象作为数据源，和Row、Entity数据源一样也实现了Fv.Changed事件、FvCell.Changed事件、淡黄色修改状态样式、支持撤销等功能；</p>
<p>Lv Tv支持所有实现INotifyList接口的数据源，常用数据源类型有Table、Table<TEntity>、Nl<T>等。</p>
<p>用户通过与这些控件的交互修改了数据，如在Fv中修改了某格的选项，在Lv中删除了某行等，但控件不包含数据持久化的功能，只是修改了数据源的值。</p>
<h3 id="应用层">应用层</h3>
<p>应用层一般是指*.xaml.cs中的代码，主要包括交互处理、加载数据源、调用实体扩展方法保存数据、调用领域服务处理交叉业务逻辑、调用微服务API等，应用层是UI、数据、业务逻辑、持久化等的粘合剂，虽然没有具体的实现细节，但却包含重要的交互控制功能，相当于MVC架构的控制层。</p>
<h3 id="领域层">领域层</h3>
<p>领域层是业务开发过程中的重要部分，包括实体、实体读写、业务逻辑、领域服务等，并且<strong>实现客户端领域层和服务端领域层代码相同</strong>，既可以将业务放在客户端处理也可以稍加修改放在服务端处理。但系统未采用DDD模式的聚合根、值对象、仓库等概念。详细请参见<a href="/dt-docs/docs/2%e5%9f%ba%e7%a1%80/3%e9%a2%86%e5%9f%9f%e5%b1%82/" rel="">领域层</a></p>
<h3 id="外观层">外观层</h3>
<p>外观层是为了屏蔽底层的实现细节，为上层提供简洁使用方法。该层通常由静态类、扩展方法等组成，比如<code>AtXxx</code>就是静态类，作为服务代理，每个服务代理对应一个微服务，如<code>AtCm</code>和<code>cm</code>服务、<code>AtMsg</code>和<code>msg</code>服务，服务代理约定的命名规则为“At + 首字母大写的服务名”，At为Access To的缩写，每个<code>Api</code>在服务代理类中都对应一个原型相同的静态方法，服务代理的主要工作是序列化请求、采用<code>http2</code>协议、<code>Post</code>方法、传输<code>json内容</code>的方式调用服务端的<code>Api</code>，返回<code>json结果</code>并将其转换成需要的类型提供给调用者，该静态方法由所属服务自动生成：
<img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/7.png" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/7.png, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/7.png 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/7.png 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/7.png" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/7.png" width="581" height="317" />
<img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/8.png" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/8.png, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/8.png 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/8.png 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/8.png" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/8.png" width="475" height="440" /></p>
<p>由上图可见，生成的代码已自动标记<code>服务名、Api、Api参数</code>，同时带有注释内容，<code>Entry.GetConfig</code>是<code>Api</code>的完整名称，其中<code>Entry</code>在服务端是一个类，<code>GetConfig</code>是它的方法，每个微服务可以包含多个<code>Api</code>类，用于区分<code>Api</code>的不同功能范围，如上图中<code>Entry</code>负责登录相关，<code>UserRoleApi</code>负责用户角色相关。</p>
<p>以上生成的静态方法属于架构图中外观层左侧的<code>Api</code>，每个服务代理<code>AtXxx</code>还负责“读数据”和“写数据”，这些读写数据的<code>Api</code>属于公共<code>Api</code>，即每个服务代理都提供的<code>Api</code>，为了使用方便，达到静态继承的目的，这部分<code>Api</code>实现的比较诡异，以<code>AtCm</code>为例看一下实现过程：
首先这部分<code>Api</code>作为静态方法放在泛型抽象类<code>DataProvider&lt;T&gt;</code>中：
<img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/9.png" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/9.png, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/9.png 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/9.png 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/9.png" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/9.png" width="702" height="401" /></p>
<p><code>AtCm</code>继承<code>DataProvider&lt;T&gt;</code>，传递<code>AccessInfo</code>类型作为泛型参数：
<img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/10.png" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/10.png, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/10.png 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/10.png 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/10.png" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/10.png" width="446" height="250" />
<img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/11.png" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/11.png, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/11.png 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/11.png 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/11.png" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/11.png" width="557" height="310" /></p>
<p>这样在调用<code>AtCm.Query</code>时就能提交给<code>cm</code>服务，<code>AtMsg.Query</code>时就能提交给<code>msg</code>服务，<code>AtState.Query</code>时就能查询本地<code>sqlite</code>库，使用非常方便。</p>
<p>这些公共Api是客户端的数据访问对象，它屏蔽了sql生成、序列化反序列化、网络通信等细节，为客户端提供数据加载和持久化功能。参见架构图中部的红箭头，它们在服务端调用的是<code>DataAccess Api</code>，直接数据访问，未涉及服务端的业务逻辑、领域事件等内容，所以这部分的业务逻辑只能放在客户端处理，对于复杂的业务逻辑尽可能放在实体<code>Entity</code>中处理，也就是DDD推荐的充血模式，可参见<code>Dt.Mgr</code>中的流程设计部分，这种模式适用于大部分场景，服务端的数据访问对于前端完全透明，类似传统的直连数据库方式，系统主要功能都在客户端完成，这些公共<code>Api</code>按功能又可分为读数据和写数据，详细内容在后面陈述。</p>
<p>架构图中外观层还包括<code>EntityEx</code> <code>EntityX</code>的扩展方法和静态泛型方法，这些在<a href="/dt-docs/docs/2%e5%9f%ba%e7%a1%80/3%e9%a2%86%e5%9f%9f%e5%b1%82/" rel="">领域层</a>已有描述。<code>Kit</code>是一个包罗万象的大静态类，涉及客户端的各个方面，不在此详述。</p>
<h3 id="数据访问层">数据访问层</h3>
<p>数据访问层是一个抽象层，对上层提供数据访问规范，对下层提供数据处理标准，主要由<code>IDataAccess</code>定义：
<img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/12.png" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/12.png, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/12.png 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/12.png 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/12.png" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/12.png" width="332" height="278" /></p>
<p>数据访问对象和DDD模式中数据仓库(Repository) 类似，介于领域层与基础层之间，负责数据映射、根据实体状态生成Sql、数据持久化等功能。它的存在让领域层感觉不到基础层的存在，领域层需要什么只需查询数据访问对象，不需要知道数据实际放在哪里。</p>
<p>客户端的数据访问对象已合并在服务代理类中，作为公共<code>Api</code>使用；服务端的数据提供者已绑定在当前<code>http</code>请求的<code>Bag</code>(私有类)中，总体架构中都已介绍，以下按照读写数据的分类进行详细说明。</p>
<h4 id="读数据">读数据</h4>
<p>借鉴CQRS读写分离的原则，数据查询采用sql参数化查询的方式，既灵活、查询速度快，也和领域相关内容解耦：
<img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/13.png" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/13.png, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/13.png 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/13.png 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/13.png" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/13.png" width="738" height="814" /></p>
<p>读数据按位置分为两种，客户端公共<code>Api</code>读数据和服务端<code>DataAccess</code>读数据，两处的方法及参数基本相同，下面以客户端为例介绍这些方法。
客户端公共查询<code>Api</code>分三类：</p>
<ol>
<li>
<p>返回实体列表，参见下图有五个方法，<code>Query</code>和<code>Query&lt;T&gt;</code>两方法参数相同，Sql键名+Sql参数，返回类型为<code>Table</code>和<code>Table&lt;T&gt;</code>，<code>Page</code>和<code>Page&lt;T&gt;</code>是按页查询，除页面参数外，其他参数和<code>Query</code>相同。
<figure><a class="lightgallery" href="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/14.png" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/14.png" data-thumbnail="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/14.png" data-sub-html="<h2>读数据</h2>">
        <img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/14.png" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/14.png, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/14.png 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/14.png 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/14.png" width="1172" height="367" />
    </a><figcaption class="image-caption">读数据</figcaption>
    </figure></p>
</li>
<li>
<p>返回单个实体对象，主要有三个方法，<code>GetRow</code>和<code>Get&lt;T&gt;</code>的参数和<code>Query</code>相同，只是返回符合条件的第一行数据，<code>GetByID&lt;T&gt;</code>是通过主键获取实体对象，不需要Sql查询语句。
<figure><a class="lightgallery" href="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/15.png" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/15.png" data-thumbnail="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/15.png" data-sub-html="<h2>读数据</h2>">
        <img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/15.png" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/15.png, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/15.png 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/15.png 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/15.png" width="807" height="298" />
    </a><figcaption class="image-caption">读数据</figcaption>
    </figure></p>
</li>
<li>
<p>查询单个值，<code>GetScalar&lt;T&gt;</code>是通过Sql参数查询返回第一单元格数据，<code>NewID</code>获取新ID，详见“分布式ID生成方案”一节，<code>NewSeq</code>获取新序列号，类似于oracle的sequence，自增长的序列号，一般用来存储显示顺序。
<figure><a class="lightgallery" href="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/16.png" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/16.png" data-thumbnail="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/16.png" data-sub-html="<h2>读数据</h2>">
        <img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/16.png" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/16.png, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/16.png 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/16.png 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/16.png" width="747" height="223" />
    </a><figcaption class="image-caption">读数据</figcaption>
    </figure></p>
</li>
</ol>
<p>整个读数据的核心就是Sql参数化查询，它是最灵活、最直观、性能最优的查询方式，远比其他ORM生成的查询好控制。</p>
<p>需要特殊说明的是，通过Sql参数查询的方式，结果不管是实体列表还是单个实体，Sql语句中的列都无需和实体属性一一对应，按需查询即可，<a href="/dt-docs/docs/2%e5%9f%ba%e7%a1%80/3%e9%a2%86%e5%9f%9f%e5%b1%82/#%e4%bb%8erow%e5%88%b0entity" rel="">从Row到Entity</a>中已介绍，因为<code>Entity</code>继承自<code>Row</code>，最终使用单元格<code>Cell</code>存储数据，而实体属性只是对<code>Cell</code>的封装，当Sql查询语句中缺少或多出某些列时，能正常进行序列化、反序列化、类型转换，只是在访问缺少的属性时异常，这样增加了很大的灵活性，比如：某列内容多但不需要显示，查询时为提高性能减少数据量就可以不查询该列，但前端其他列的绑定都不受影响。Sql查询语句中也可以比实体属性多出一些列，比如通过多表联合查询的翻译列等，这些多出的列在绑定显示时同样不受影响。</p>
<h4 id="写数据">写数据</h4>
<p>系统提供的写数据方式共两种，第一种为通过客户端领域层，将待持久化的实体在客户端生成Sql，交由代理方法调用服务端<code>DataAccess Api</code>，最终由<code>MySqlAccess OracleAccess SqlServerAccess PostgreSqlAccess</code>将数据持久化到数据库，该模式可以理解为传统的sql方式，只是sql语句由程序自动生成；第二种是整个过程在服务端完成。<strong>原则上整个系统不允许出现含insert update delete的sql语句，增删改的sql语句都由系统自动生成。</strong></p>
<p>保存单个实体数据使用<code>Save&lt;T&gt;</code>方法，该方法根据实体状态<code>IsAdded</code>确定是<code>insert</code>还是<code>update</code>，当<code>update</code>时，只将变化的<code>Cell</code>(根据<code>IsChanged</code>状态)生成sql语句；收集领域事件，在保存成功后统一触发。
<img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/17.png" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/17.png, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/17.png 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/17.png 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/17.png" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/17.png" width="823" height="189" /></p>
<div class="details admonition warning open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-exclamation-triangle fa-fw" aria-hidden="true"></i>警告<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><code>Exec</code>和<code>BatchExec</code>是直接执行sql语句，业务开发时禁止使用。</div>
        </div>
    </div>
<h3 id="基础层">基础层</h3>
<p>基础层负责序列化反序列化、网络通信、接口实现等基础性工作，如<code>RemoteAccess</code>实现远程数据访问，<code>SqliteAccess</code>实现本地<code>sqlite</code>库数据访问，<code>UnaryRpc</code>实现基于<code>Http2</code>的请求/响应模式的远程调用等等。这部分大多是一些私有的内部类，上层业务开发不涉及。</p>
<h2 id="服务端">服务端</h2>
<h3 id="领域层-1">领域层</h3>
<p>服务端领域层结构与客户端相同，代码通用，因此不再重复描述，只描述不同内容。</p>
<p><code>Api</code>层不再作为完整的层存在，传统<code>Api</code>层对应于当前系统的领域服务，是客户端提交请求的入口，因采用富客户端单页模式，所以请求参数和返回结果都为数据，无UI相关内容，可以包含参数校验、实体加载、多种类型实体之间的业务交互、数据持久化等内容。在实现上<code>Api</code>类继承自<code>DomainSvc</code>并带有Api标签，如下图：
<img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/18.png" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/18.png, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/18.png 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/18.png 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/18.png" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/18.png" width="323" height="58" /></p>
<p>每个<code>Api</code>类在服务的<code>.admin</code>页面都可以查看到：
<img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/19.png" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/19.png, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/19.png 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/19.png 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/19.png" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/19.png" width="581" height="317" /></p>
<p>点击<code>Api</code>方法进入测试页面，输入参数可以手动测试：
<img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/20.png" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/20.png, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/20.png 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/20.png 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/20.png" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/20.png" width="581" height="471" /></p>
<p><code>Api</code>类已注册为服务，调用时首先创建服务实例，调用业务方法，并且在<code>Api</code>调用结束后，根据是否成功处理后续工作，如提交或回滚事务、关闭数据库连接等。</p>
<p>基类<code>DomainSvc</code>包含以下成员：
<img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/21.png" data-srcset="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/21.png, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/21.png 1.5x, /dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/21.png 2x" data-sizes="auto" alt="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/21.png" title="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/21.png" width="685" height="838" /></p>
<h3 id="基础层-1">基础层</h3>
<p>服务端基础层主要包括日志、本地事件、远程事件、数据访问、缓存处理等功能，在开发时可通过Kit静态类调用。</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <section class="post-tags"></section>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://daotingh.gitee.io/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/" data-title="总体架构"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 百度" data-sharer="baidu" data-url="https://daotingh.gitee.io/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/" data-title="总体架构"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@6.20.0/icons/baidu.svg" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>
</div>
</article><div class="toc" id="toc-auto">
                <h2 class="toc-title">目录</h2>
                <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#常见服务架构">常见服务架构</a></li>
    <li><a href="#总体架构">总体架构</a></li>
    <li><a href="#客户端">客户端</a>
      <ul>
        <li><a href="#view层">View层</a></li>
        <li><a href="#viewmodel层">ViewModel层</a></li>
        <li><a href="#应用层">应用层</a></li>
        <li><a href="#领域层">领域层</a></li>
        <li><a href="#外观层">外观层</a></li>
        <li><a href="#数据访问层">数据访问层</a>
          <ul>
            <li><a href="#读数据">读数据</a></li>
            <li><a href="#写数据">写数据</a></li>
          </ul>
        </li>
        <li><a href="#基础层">基础层</a></li>
      </ul>
    </li>
    <li><a href="#服务端">服务端</a>
      <ul>
        <li><a href="#领域层-1">领域层</a></li>
        <li><a href="#基础层-1">基础层</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div></div>
    </div>
</div>
            </main>
            <footer class="footer">
                <div class="footer-container"><div class="footer-line">搬运工</div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2023 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/dt-docs/" target="_blank">Daoting</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
                </div>
            </footer>
        </div>

        <div id="fixed-buttons">
            <a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a>
            <a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.4.0/css/lightgallery-bundle.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.13.0/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.1/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.4.0/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.4.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.4.0/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":50},"lightgallery":true,"search":{"algoliaAppID":"PASDMWALPK","algoliaIndex":"index.zh-cn","algoliaSearchKey":"b42948e51daaa93df92381c8e2ac0f93","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":30,"type":"algolia"}};</script><script type="text/javascript" src="/dt-docs/js/theme.min.js"></script>
    </body>
</html>
