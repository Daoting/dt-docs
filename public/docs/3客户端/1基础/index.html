<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>基础 - 搬运工</title>
        <meta name="Description" content="利用 C# &#43; XAML 进行快速业务开发的跨平台框架">
        <meta name="application-name" content="搬运工">
        <meta name="apple-mobile-web-app-title" content="搬运工">
        <meta name="theme-color" content="#ffffff">
        <meta name="msapplication-TileColor" content="#da532c">
        <link rel="shortcut icon" type="image/x-icon" href="/dt-docs/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/dt-docs/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/dt-docs/favicon-16x16.png">
        <link rel="apple-touch-icon" sizes="180x180" href="/dt-docs/apple-touch-icon.png">
        <link rel="mask-icon" href="/dt-docs/safari-pinned-tab.svg" color="#5bbad5">
        <link rel="manifest" href="/dt-docs/site.webmanifest">
        <link rel="canonical" href="https://daotingh.gitee.io/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/" />
        <link rel="alternate" href="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/index.xml" type="application/rss+xml" title="搬运工">
        <link rel="feed" href="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/index.xml" type="application/rss+xml" title="搬运工"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/dt-docs/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css">
    </head>
    <body data-header-desktop="fixed" data-header-mobile="auto">
        <script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>
        <div id="mask"></div>
        <div class="wrapper">
            <header class="desktop" id="header-desktop">
                <div class="header-wrapper">
                    <div class="header-title">
                        <a href="/dt-docs/" title="搬运工"><img class="lazyload logo" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/favicon-32x32.png" data-srcset="/dt-docs/favicon-32x32.png, /dt-docs/favicon-32x32.png 1.5x, /dt-docs/favicon-32x32.png 2x" data-sizes="auto" alt="/dt-docs/favicon-32x32.png" title="/dt-docs/favicon-32x32.png" />搬运工</a>
                    </div>
                    <div class="menu">
                        <div class="menu-inner"><a class="menu-item" href="/dt-docs/posts/"> 文章 </a><a class="menu-item" href="/dt-docs/docs/"> 教程 </a><a class="menu-item" href="https://github.com/daoting/dt" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i>  </a><span class="menu-item delimiter"></span>
                            <span class="menu-item search" id="search-desktop">
                                <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                                <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                                    <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                                </a>
                                <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                                    <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                                </a>
                                <span class="search-button search-loading" id="search-loading-desktop">
                                    <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                                </span>
                            </span>
                            <a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </header>
            <header class="mobile" id="header-mobile">
                <div class="header-container">
                    <div class="header-wrapper">
                        <div class="header-title">
                            <a href="/dt-docs/" title="搬运工"><img class="lazyload logo" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/favicon-32x32.png" data-srcset="/dt-docs/favicon-32x32.png, /dt-docs/favicon-32x32.png 1.5x, /dt-docs/favicon-32x32.png 2x" data-sizes="auto" alt="/dt-docs/favicon-32x32.png" title="/dt-docs/favicon-32x32.png" />搬运工</a>
                        </div>
                        <div class="menu-toggle" id="menu-toggle-mobile">
                            <span></span><span></span><span></span>
                        </div>
                    </div>
                    <div class="menu" id="menu-mobile">
                        <div class="search-wrapper">
                            <div class="search mobile" id="search-mobile">
                                <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                                <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                                    <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                                </a>
                                <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                                    <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                                </a>
                                <span class="search-button search-loading" id="search-loading-mobile">
                                    <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                                </span>
                            </div>
                            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                                取消
                            </a>
                        </div>
                        <a class="menu-item" href="/dt-docs/posts/" title="">文章</a>
                        <a class="menu-item" href="/dt-docs/docs/" title="">教程</a>
                        <a class="menu-item" href="https://github.com/daoting/dt" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i></a>
                        <a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                            <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                        </a>
                    </div>
                </div>
            </header>
            <div class="search-dropdown desktop">
                <div id="search-dropdown-desktop"></div>
            </div>
            <div class="search-dropdown mobile">
                <div id="search-dropdown-mobile"></div>
            </div>
            <main class="main"><div class="doc-frame">
    <aside class="doc-tree">
        <div id="content-mobile">
  <button class="fas fa-bars" type="button" onclick="var nav = document.getElementById('td-section-nav'); nav.style.display = (nav.style.display == 'block') ? 'none' : 'block' ">
  </button>
</div>
<nav class="td-sidebar-nav" id="td-section-nav">
  <ul class="td-sidebar-nav__section">
    <li>
  <a href="/dt-docs/docs/" title="概述" class="td-sidebar-link tree-root"><span>概述</span></a>
  <ul  class="ul-1" >
    <li>
  <a href="/dt-docs/docs/1%E5%BC%80%E5%A7%8B/" title="开始" class="td-sidebar-link"><span>开始</span></a>
  <ul >
    <li>
  <a href="/dt-docs/docs/1%E5%BC%80%E5%A7%8B/1%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/" title="开发环境" class="td-sidebar-link"><span>开发环境</span></a>
</li><li>
  <a href="/dt-docs/docs/1%E5%BC%80%E5%A7%8B/2%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE/" title="创建空项目" class="td-sidebar-link"><span>创建空项目</span></a>
</li><li>
  <a href="/dt-docs/docs/1%E5%BC%80%E5%A7%8B/3%E5%B0%8F%E8%AF%95%E7%89%9B%E5%88%80/" title="小试牛刀" class="td-sidebar-link"><span>小试牛刀</span></a>
</li><li>
  <a href="/dt-docs/docs/1%E5%BC%80%E5%A7%8B/4%E6%90%AC%E8%BF%90%E5%B7%A5%E6%A0%B7%E4%BE%8B/" title="搬运工样例" class="td-sidebar-link"><span>搬运工样例</span></a>
</li>
  </ul>
</li><li>
  <a href="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/" title="基础" class="td-sidebar-link"><span>基础</span></a>
  <ul >
    <li>
  <a href="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/1%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/" title="总体架构" class="td-sidebar-link"><span>总体架构</span></a>
</li><li>
  <a href="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/2%E5%9F%BA%E7%A1%80%E5%8A%9F%E8%83%BD/" title="基础功能" class="td-sidebar-link"><span>基础功能</span></a>
</li><li>
  <a href="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/3%E9%A2%86%E5%9F%9F%E5%B1%82/" title="领域层" class="td-sidebar-link"><span>领域层</span></a>
</li><li>
  <a href="/dt-docs/docs/2%E5%9F%BA%E7%A1%80/4%E6%9C%8D%E5%8A%A1/" title="服务" class="td-sidebar-link"><span>服务</span></a>
</li>
  </ul>
</li><li>
  <a href="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/" title="客户端" class="td-sidebar-link"><span>客户端</span></a>
  <ul >
    <li>
  <a href="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/" title="基础" class="td-sidebar-link active"><span>基础</span></a>
</li><li>
  <a href="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/2%E7%95%8C%E9%9D%A2%E6%A1%86%E6%9E%B6/" title="界面框架" class="td-sidebar-link"><span>界面框架</span></a>
</li><li>
  <a href="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/3fv/" title="Fv" class="td-sidebar-link"><span>Fv</span></a>
</li><li>
  <a href="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/4lv/" title="Lv" class="td-sidebar-link"><span>Lv</span></a>
</li><li>
  <a href="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/5tab/" title="Tab" class="td-sidebar-link"><span>Tab</span></a>
</li><li>
  <a href="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/6%E5%9F%BA%E7%A1%80%E6%8E%A7%E4%BB%B6/" title="基础控件" class="td-sidebar-link"><span>基础控件</span></a>
</li>
  </ul>
</li><li>
  <a href="/dt-docs/docs/4%E5%8F%91%E5%B8%83%E9%83%A8%E7%BD%B2/" title="发布部署" class="td-sidebar-link"><span>发布部署</span></a>
  <ul >
    <li>
  <a href="/dt-docs/docs/4%E5%8F%91%E5%B8%83%E9%83%A8%E7%BD%B2/1%E6%9C%8D%E5%8A%A1/" title="服务" class="td-sidebar-link"><span>服务</span></a>
</li><li>
  <a href="/dt-docs/docs/4%E5%8F%91%E5%B8%83%E9%83%A8%E7%BD%B2/2win%E5%BA%94%E7%94%A8/" title="Win应用" class="td-sidebar-link"><span>Win应用</span></a>
</li><li>
  <a href="/dt-docs/docs/4%E5%8F%91%E5%B8%83%E9%83%A8%E7%BD%B2/3android%E5%BA%94%E7%94%A8/" title="Android应用" class="td-sidebar-link"><span>Android应用</span></a>
</li><li>
  <a href="/dt-docs/docs/4%E5%8F%91%E5%B8%83%E9%83%A8%E7%BD%B2/4ios%E5%BA%94%E7%94%A8/" title="iOS应用" class="td-sidebar-link"><span>iOS应用</span></a>
</li><li>
  <a href="/dt-docs/docs/4%E5%8F%91%E5%B8%83%E9%83%A8%E7%BD%B2/5wasm%E5%BA%94%E7%94%A8/" title="Wasm应用" class="td-sidebar-link"><span>Wasm应用</span></a>
</li>
  </ul>
</li>
  </ul>
</li>
  </ul>
</nav>


    </aside>
    <div class="doc-main">
        <div class="container">
            <article class="page single"><h1 class="single-title animate__animated animate__flipInX">基础</h1><div class="post-meta">
                    <div class="post-meta-line">
                        <i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;约 5647 字&nbsp;
                        <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;预计阅读 12 分钟&nbsp;</div>
                </div><div class="content" id="content"><h2 id="本地存储">本地存储</h2>
<p>客户端本地文件存储的根目录为<code>Kit.RootPath</code>，在不同平台对应不同位置，如：
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cs" data-lang="cs"><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// 本地文件的根路径</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// uwp：C:\Users\...\LocalState</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// android：/data/user/0/App.Droid/files</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// ios：/Users/usrname/Library/Developer/CoreSimulator/Devices/xxx/data/Containers/Data/Application/yyy/Library/Data</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// wasm：/local</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="n">RootPath</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ApplicationData</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">LocalFolder</span><span class="p">.</span><span class="n">Path</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// 本地缓存文件的存放路径</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// uwp：C:\Users\...\LocalState\.doc</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// android：/data/user/0/App.Droid/files/.doc</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// ios：/Users/usrname/Library/Developer/CoreSimulator/Devices/xxx/data/Containers/Data/Application/yyy/Library/Data/.doc</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// wasm：/local/.doc</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="n">CachePath</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">ApplicationData</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">LocalFolder</span><span class="p">.</span><span class="n">Path</span><span class="p">,</span> <span class="s">&#34;.doc&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// 本地sqlite数据文件的存放路径</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// uwp：C:\Users\...\LocalState\.data</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// android：/data/user/0/App.Droid/files/.data</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// ios：/Users/usrname/Library/Developer/CoreSimulator/Devices/xxx/data/Containers/Data/Application/yyy/Library/Data/.data</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// wasm：/local/.doc</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="n">DataPath</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">ApplicationData</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">LocalFolder</span><span class="p">.</span><span class="n">Path</span><span class="p">,</span> <span class="s">&#34;.data&#34;</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div>
<img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/2.png" data-srcset="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/2.png, /dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/2.png 1.5x, /dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/2.png 2x" data-sizes="auto" alt="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/2.png" title="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/2.png" width="755" height="122" /></p>
<p><code>.doc</code>目录存储所有的缓存文件，如头像图片、下载的各种文件等等。</p>
<p><code>.data</code>目录下的<code>.db</code>文件是Sqlite库文件，每个<code>.db</code>文件都是一个Sqlite库，<code>state.db</code>为状态库文件，存储App运行过程中产生的数据；<code>model.db</code>为模型库文件，是只读库，主要存储不经常变化的数据，从服务端下载，服务端更新时自动同步。除<code>state.db</code>和<code>model.db</code>之外，系统也支持自定义，只需在定义实体时指定sqlite库名即可：
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cs" data-lang="cs"><span class="line"><span class="cl"><span class="na">[Sqlite(&#34;local&#34;)]</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">CrudX</span> <span class="p">:</span> <span class="n">EntityX</span><span class="p">&lt;</span><span class="n">CrudX</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div></p>
<p>每个Sqlite库对应一个操作类，该类负责数据的<code>CRUD</code>，如<code>AtState、AtModel</code>分别为<code>state.db</code>和<code>model.db</code>的操作类，详细操作参见<a href="/dt-docs/docs/2%e5%9f%ba%e7%a1%80/3%e9%a2%86%e5%9f%9f%e5%b1%82/" rel="">领域层</a>。</p>
<h2 id="当前用户">当前用户</h2>
<p>可以通过静态类<code>Kit</code>访问与当前登录用户相关的信息，包括具有的权限、用户参数等。
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cs" data-lang="cs"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">Kit</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 用户ID</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="kt">long</span> <span class="n">UserID</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 姓名</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="n">UserName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="s">&#34;无&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 手机号码</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="n">UserPhone</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 头像</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="n">UserPhoto</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 是否已登录</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="kt">bool</span> <span class="n">IsLogon</span> <span class="p">=&gt;</span> <span class="n">UserID</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// cookie自动登录</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;p_showWarning&#34;&gt;是否显示警告信息&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="n">Task</span><span class="p">&lt;</span><span class="kt">bool</span><span class="p">&gt;</span> <span class="n">LoginByCookie</span><span class="p">(</span><span class="kt">bool</span> <span class="n">p_showWarning</span> <span class="p">=</span> <span class="k">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 判断当前登录用户是否具有指定权限</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;p_permission&#34;&gt;权限名称&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;returns&gt;true 表示有权限&lt;/returns&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="n">Task</span><span class="p">&lt;</span><span class="kt">bool</span><span class="p">&gt;</span> <span class="n">HasPermission</span><span class="p">(</span><span class="kt">string</span> <span class="n">p_permission</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 根据参数id获取用户参数值</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;typeparam name=&#34;T&#34;&gt;&lt;/typeparam&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;p_paramID&#34;&gt;&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">GetParamByID</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="kt">long</span> <span class="n">p_paramID</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 根据参数名称获取用户参数值</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;typeparam name=&#34;T&#34;&gt;&lt;/typeparam&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;p_paramName&#34;&gt;&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">GetParamByName</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="kt">string</span> <span class="n">p_paramName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 保存用户参数值</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;p_paramID&#34;&gt;&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;p_value&#34;&gt;&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="n">Task</span><span class="p">&lt;</span><span class="kt">bool</span><span class="p">&gt;</span> <span class="n">SaveParams</span><span class="p">(</span><span class="kt">string</span> <span class="n">p_paramID</span><span class="p">,</span> <span class="kt">string</span> <span class="n">p_value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div></p>
<h2 id="启动过程">启动过程</h2>
<p><figure><a class="lightgallery" href="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/1.png" title="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/1.png" data-thumbnail="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/1.png" data-sub-html="<h2>启动过程</h2>">
        <img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/1.png" data-srcset="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/1.png, /dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/1.png 1.5x, /dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/1.png 2x" data-sizes="auto" alt="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/1.png" width="929" height="1523" />
    </a><figcaption class="image-caption">启动过程</figcaption>
    </figure></p>
<h2 id="基础选项">基础选项</h2>
<p>基础选项属于客户端缓存的内容，sqlite模型库的<code>OmOption</code>表，是按分类组织的选项，主要用于字符串选择的场景，如性别、民族、学历、地区等分类选项，常用作<code>CList</code>的数据源，设置<code>Ex</code>属性为分类名称<code>Option#XX</code>即可。
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;a:CList</span> <span class="na">ID=</span><span class="s">&#34;code&#34;</span> <span class="na">Title=</span><span class="s">&#34;民族&#34;</span> <span class="na">Ex=</span><span class="s">&#34;Option#民族&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;a:CList</span> <span class="na">ID=</span><span class="s">&#34;degree&#34;</span> <span class="na">Title=</span><span class="s">&#34;学历&#34;</span> <span class="na">Ex=</span><span class="s">&#34;Option#学历&#34;</span> <span class="nt">/&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div></p>
<p>选项的内容可以增删，调整后需要“更新模型”。
<img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/4.png" data-srcset="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/4.png, /dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/4.png 1.5x, /dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/4.png 2x" data-sizes="auto" alt="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/4.png" title="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/4.png" width="1130" height="390" /></p>
<h2 id="提醒与通知">提醒与通知</h2>
<p><code>app</code>激活时使用<code>Kit.Msg Kit.Warn Kit.Error</code>提示消息，不使用通知。</p>
<p>通知一般和后台任务配合，用来在<code>app</code>退出时提醒用户，通知的功能主要两部分：显示标题和内容；点击通知后打开或激活<code>app</code>并显示通知的关联页。推送通知使用<code>Kit.Toast</code>方法：
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cs" data-lang="cs"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">Kit</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 发布消息提示</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;p_content&#34;&gt;显示内容&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;p_delaySeconds&#34;&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 几秒后自动关闭，默认3秒</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;para&gt;大于0：启动定时器自动关闭，点击也关闭&lt;/para&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;para&gt;0：不自动关闭，但点击关闭&lt;/para&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;para&gt;小于0：始终不关闭，只有程序控制关闭&lt;/para&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="n">NotifyInfo</span> <span class="n">Msg</span><span class="p">(</span><span class="kt">string</span> <span class="n">p_content</span><span class="p">,</span> <span class="kt">int</span> <span class="n">p_delaySeconds</span> <span class="p">=</span> <span class="m">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 警告提示</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;p_content&#34;&gt;显示内容&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;p_delaySeconds&#34;&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 几秒后自动关闭，默认5秒</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;para&gt;大于0：启动定时器自动关闭，点击也关闭&lt;/para&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;para&gt;0：不自动关闭，但点击关闭&lt;/para&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;para&gt;小于0：始终不关闭，只有程序控制关闭&lt;/para&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="n">NotifyInfo</span> <span class="n">Warn</span><span class="p">(</span><span class="kt">string</span> <span class="n">p_content</span><span class="p">,</span> <span class="kt">int</span> <span class="n">p_delaySeconds</span> <span class="p">=</span> <span class="m">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 显示错误对话框</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;p_content&#34;&gt;消息内容&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;p_title&#34;&gt;标题&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="n">Error</span><span class="p">(</span><span class="kt">string</span> <span class="n">p_content</span><span class="p">,</span> <span class="kt">string</span> <span class="n">p_title</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 显示系统通知，iOS只有app在后台或关闭时才显示！其他平台始终显示</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;p_title&#34;&gt;标题&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;p_content&#34;&gt;内容&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;p_startInfo&#34;&gt;点击通知的启动参数&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="n">Toast</span><span class="p">(</span><span class="kt">string</span> <span class="n">p_title</span><span class="p">,</span> <span class="kt">string</span> <span class="n">p_content</span><span class="p">,</span> <span class="n">AutoStartInfo</span> <span class="n">p_startInfo</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div></p>
<h2 id="后台任务">后台任务</h2>
<p>后台任务是系统的重要补充，它能够在不打开app的情况下访问服务器，获得所需的提醒，各平台实现方式不同，windows android是独立的真后台，iOS只是模拟的后台而且运行不准时，为了实现跨平台效果，后台统一采用定时执行的方式，windows android为默认的最小时间间隔15分钟，iOS无法保证准确的时间间隔。</p>
<p>同样后台任务需要在<code>AppStub</code>的<code>ConfigureServices</code>方法注入后台任务服务，完成后台任务内容即可。
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="hl"><span class="lnt"> 7
</span></span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cs" data-lang="cs"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">class</span> <span class="nc">AppStub</span> <span class="p">:</span> <span class="n">DefaultStub</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="n">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">p_svcs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">base</span><span class="p">.</span><span class="n">ConfigureServices</span><span class="p">(</span><span class="n">p_svcs</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">p_svcs</span><span class="p">.</span><span class="n">AddSingleton</span><span class="p">&lt;</span><span class="n">IRpcConfig</span><span class="p">,</span> <span class="n">RpcConfig</span><span class="p">&gt;();</span>
</span></span><span class="line hl"><span class="cl">        <span class="n">p_svcs</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">IBackgroundJob</span><span class="p">,</span> <span class="n">BackgroundJob</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="n">p_svcs</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">IReceiveShare</span><span class="p">,</span> <span class="n">ReceiveShare</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="n">p_svcs</span><span class="p">.</span><span class="n">AddSingleton</span><span class="p">&lt;</span><span class="n">ILogSetting</span><span class="p">,</span> <span class="n">LogSetting</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="n">p_svcs</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">ITheme</span><span class="p">,</span> <span class="n">CustomTheme</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BackgroundJob</span> <span class="p">:</span> <span class="n">IBackgroundJob</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 后台任务处理，除 AtState、Stub、Kit.Rpc、Kit.Toast 外，不可使用任何UI和外部变量，保证可独立运行！！！</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 记录日志使用 BgJob.WriteLog</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="n">Run</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//string tpName = AtState.GetCookie(&#34;LoginPhone&#34;);</span>
</span></span><span class="line"><span class="cl">        <span class="n">Kit</span><span class="p">.</span><span class="n">Toast</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s">&#34;样例&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">.</span><span class="n">ToString</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">AutoStartInfo</span> <span class="p">{</span> <span class="n">WinType</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">LvHome</span><span class="p">).</span><span class="n">AssemblyQualifiedName</span><span class="p">,</span> <span class="n">Title</span> <span class="p">=</span> <span class="s">&#34;列表&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="n">CompletedTask</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div></p>
<p>目前后台任务存在的问题：</p>
<ul>
<li>android：延时15分钟后执行，关闭app后不运行后台任务，WorkManager not working when app is killed</li>
<li>iOS：在真机、未禁止后台刷新、非省电模式、锁屏的情况下，最小延时15分钟后执行，其它情况不执行！！！</li>
<li>win：x64模式下运行完美，延时15分钟</li>
<li>wasm：不支持</li>
</ul>
<p>详细参见<a href="https://github.com/Daoting/dt/issues/3" target="_blank" rel="noopener noreffer">后台任务问题</a></p>
<p>以下是各平台的实现细节，业务开发过程用不到，有兴趣的可以参考：</p>
<h3 id="windows">Windows</h3>
<p>在包配置文件Package.appxmanifest中设置定时器入口：
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="hl"><span class="lnt">15
</span></span><span class="hl"><span class="lnt">16
</span></span><span class="hl"><span class="lnt">17
</span></span><span class="hl"><span class="lnt">18
</span></span><span class="hl"><span class="lnt">19
</span></span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="hl"><span class="lnt">43
</span></span><span class="hl"><span class="lnt">44
</span></span><span class="hl"><span class="lnt">45
</span></span><span class="hl"><span class="lnt">46
</span></span><span class="hl"><span class="lnt">47
</span></span><span class="hl"><span class="lnt">48
</span></span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">    <span class="nt">&lt;Applications&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;Application</span> <span class="na">Id=</span><span class="s">&#34;App&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="na">Executable=</span><span class="s">&#34;$targetnametoken$.exe&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="na">EntryPoint=</span><span class="s">&#34;$targetentrypoint$&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;uap:VisualElements</span>
</span></span><span class="line"><span class="cl">              <span class="na">DisplayName=</span><span class="s">&#34;搬运工-WinUI&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="na">Description=</span><span class="s">&#34;WinUI版搬运工&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="na">BackgroundColor=</span><span class="s">&#34;transparent&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="na">Square150x150Logo=</span><span class="s">&#34;Assets\Square150x150Logo.png&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="na">Square44x44Logo=</span><span class="s">&#34;Assets\Square44x44Logo.png&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;uap:DefaultTile</span> <span class="na">Wide310x150Logo=</span><span class="s">&#34;Assets\Wide310x150Logo.png&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;uap:SplashScreen</span> <span class="na">Image=</span><span class="s">&#34;Assets\SplashScreen.png&#34;</span> <span class="na">BackgroundColor=</span><span class="s">&#34;#1BA1E2&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/uap:VisualElements&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;Extensions&gt;</span>
</span></span><span class="line hl"><span class="cl">                <span class="nt">&lt;Extension</span> <span class="na">Category=</span><span class="s">&#34;windows.backgroundTasks&#34;</span> <span class="na">EntryPoint=</span><span class="s">&#34;Dt.Tasks.TimeTriggeredTask&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line hl"><span class="cl">                    <span class="nt">&lt;BackgroundTasks&gt;</span>
</span></span><span class="line hl"><span class="cl">                        <span class="nt">&lt;Task</span> <span class="na">Type=</span><span class="s">&#34;timer&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line hl"><span class="cl">                    <span class="nt">&lt;/BackgroundTasks&gt;</span>
</span></span><span class="line hl"><span class="cl">                <span class="nt">&lt;/Extension&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c">&lt;!--单击Toast通知激活的 CLSID--&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;desktop:Extension</span> <span class="na">Category=</span><span class="s">&#34;windows.toastNotificationActivation&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;desktop:ToastNotificationActivation</span> <span class="na">ToastActivatorCLSID=</span><span class="s">&#34;10ab3dd3-6a3c-41b1-93a2-5fde2f2c7c28&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/desktop:Extension&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c">&lt;!--Register COM CLSID LocalServer32 registry key--&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;com:Extension</span> <span class="na">Category=</span><span class="s">&#34;windows.comServer&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;com:ComServer&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;com:ExeServer</span> <span class="na">Executable=</span><span class="s">&#34;Dt.Shell.Win.exe&#34;</span> <span class="na">Arguments=</span><span class="s">&#34;-ToastActivated&#34;</span> <span class="na">DisplayName=</span><span class="s">&#34;Toast activator&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;com:Class</span> <span class="na">Id=</span><span class="s">&#34;10ab3dd3-6a3c-41b1-93a2-5fde2f2c7c28&#34;</span> <span class="na">DisplayName=</span><span class="s">&#34;Toast activator&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/com:ExeServer&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/com:ComServer&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/com:Extension&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/Extensions&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/Application&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/Applications&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;Capabilities&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;rescap:Capability</span> <span class="na">Name=</span><span class="s">&#34;runFullTrust&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/Capabilities&gt;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;Extensions&gt;</span>
</span></span><span class="line hl"><span class="cl">        <span class="nt">&lt;Extension</span> <span class="na">Category=</span><span class="s">&#34;windows.activatableClass.inProcessServer&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line hl"><span class="cl">            <span class="nt">&lt;InProcessServer&gt;</span>
</span></span><span class="line hl"><span class="cl">                <span class="nt">&lt;Path&gt;</span>WinRT.Host.dll<span class="nt">&lt;/Path&gt;</span>
</span></span><span class="line hl"><span class="cl">                <span class="nt">&lt;ActivatableClass</span> <span class="na">ActivatableClassId=</span><span class="s">&#34;Dt.Tasks.TimeTriggeredTask&#34;</span> <span class="na">ThreadingModel=</span><span class="s">&#34;both&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line hl"><span class="cl">            <span class="nt">&lt;/InProcessServer&gt;</span>
</span></span><span class="line hl"><span class="cl">        <span class="nt">&lt;/Extension&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/Extensions&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div>
后台定时任务的入口类必须在<code>.winmd</code>项目中，如<code>Dt.Task</code>项目生成<code>Dt.Task.winmd</code>，该类只起到入口作用，不依赖任何其他程序集，如：
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cs" data-lang="cs"><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// 锁屏后定时启动后台任务，后台任务必须在*.winmd项目中，最小时间间隔15分钟</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">TimeTriggeredTask</span> <span class="p">:</span> <span class="n">IBackgroundTask</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 后台处理入口</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;taskInstance&#34;&gt;&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">async</span> <span class="k">void</span> <span class="n">Run</span><span class="p">(</span><span class="n">IBackgroundTaskInstance</span> <span class="n">taskInstance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">deferral</span> <span class="p">=</span> <span class="n">taskInstance</span><span class="p">.</span><span class="n">GetDeferral</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Type</span> <span class="n">tp</span> <span class="p">=</span> <span class="n">Type</span><span class="p">.</span><span class="n">GetType</span><span class="p">(</span><span class="s">&#34;Dt.Core.BgJob,Dt.Core&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">tp</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="kt">var</span> <span class="n">run</span> <span class="p">=</span> <span class="n">tp</span><span class="p">.</span><span class="n">GetMethod</span><span class="p">(</span><span class="s">&#34;Run&#34;</span><span class="p">,</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Public</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Static</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="kt">var</span> <span class="n">task</span> <span class="p">=</span> <span class="n">run</span><span class="p">.</span><span class="n">Invoke</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="k">new</span> <span class="kt">object</span><span class="p">[]</span> <span class="p">{</span> <span class="p">})</span> <span class="k">as</span> <span class="n">Task</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">await</span> <span class="n">task</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">catch</span> <span class="p">{</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">deferral</span><span class="p">.</span><span class="n">Complete</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div></p>
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw" aria-hidden="true"></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">因win后台是完全独立的，即使<code>app</code>在前台已打开也没有任何关系，所以后台代码中除 AtState、UnaryRpc、Kit.Toast 外，不可使用任何UI和外部变量，保证可独立运行！！！唯一UI相关的是Kit.Toast显示通知。</div>
        </div>
    </div>
<h3 id="android">Android</h3>
<p>安卓版后台经历了多次变更，以前的方法都已过时后台触发不稳定，最后选定google提供的WorkManager方式(费挺大周折)，该方式需要引用包：
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="hl"><span class="lnt">4
</span></span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;ItemGroup</span> <span class="na">Condition=</span><span class="s">&#34;$(TargetFramework.Contains(&#39;-android&#39;))&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">&#34;Square.OkHttp3&#34;</span> <span class="na">Version=</span><span class="s">&#34;4.9.3.2&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- WorkManager后台任务引用 --&gt;</span>
</span></span><span class="line hl"><span class="cl">    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">&#34;Xamarin.AndroidX.Work.Runtime&#34;</span> <span class="na">Version=</span><span class="s">&#34;2.7.1.4&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/ItemGroup&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div>
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw" aria-hidden="true"></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">升级到.net-maui后，关闭app后不运行后台任务！</div>
        </div>
    </div></p>
<h3 id="ios">iOS</h3>
<p>利用Background Fetch方式实现后台任务，首先在Info.plist中开启：
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">    <span class="c">&lt;!--后台模式--&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;key&gt;</span>UIBackgroundModes<span class="nt">&lt;/key&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;array&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="nt">&lt;string&gt;</span>fetch<span class="nt">&lt;/string&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="nt">&lt;string&gt;</span>processing<span class="nt">&lt;/string&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;/array&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--后台任务标识，代码中注册和请求时一致--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;key&gt;</span>BGTaskSchedulerPermittedIdentifiers<span class="nt">&lt;/key&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;array&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;string&gt;</span>Dt.Core.BgJob<span class="nt">&lt;/string&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/array&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cs" data-lang="cs"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">BgJob</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">ToastStart</span> <span class="p">=</span> <span class="s">&#34;ToastStart&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 和 Info.plist 的 BGTaskSchedulerPermittedIdentifiers 值相同</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">string</span> <span class="n">_taskID</span> <span class="p">=</span> <span class="s">&#34;Dt.Core.BgJob&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 注册后台任务必须在 AppDelegate 构造方法中调用</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="n">RegisterEarliest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// iOS13 以后原 Background Fetch 方式失效，采用注册后台任务、提交后台任务请求的方式</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 注册和提交请求通过 _taskID 识别任务，和 Info.plist 的 BGTaskSchedulerPermittedIdentifiers 值相同！</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 只有真机才能成功提交后台任务请求！！！</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// https://dzone.com/articles/how-to-update-app-content-with-background-tasks-us</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// https://github.com/spaceotech/BackgroundTask/blob/master/SOBackgroundTask/Application/AppDelegate.swift</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 必须在 AppDelegate 构造方法中调用！！！</span>
</span></span><span class="line"><span class="cl">            <span class="kt">bool</span> <span class="n">suc</span> <span class="p">=</span> <span class="n">BGTaskScheduler</span><span class="p">.</span><span class="n">Shared</span><span class="p">.</span><span class="n">Register</span><span class="p">(</span><span class="n">_taskID</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="n">BgJobHandler</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">Debug</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">suc</span> <span class="p">?</span> <span class="s">&#34;后台任务注册成功&#34;</span> <span class="p">:</span> <span class="s">&#34;后台任务注册失败&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Debug</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&#34;后台任务注册异常：&#34;</span> <span class="p">+</span> <span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<h3 id="统一后台任务">统一后台任务</h3>
<p>三平台的后台任务最终统一调BgJob.Run方法，该方法是后台任务运行入口：
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cs" data-lang="cs"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 后台任务运行入口</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 此方法不可使用任何UI和外部变量，保证可独立运行！！！</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="n">Run</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">WriteLog</span><span class="p">(</span><span class="s">&#34;进入Run&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 前端在运行或后台资源未释放，Stub实例存在</span>
</span></span><span class="line"><span class="cl">        <span class="n">Stub</span> <span class="n">stub</span> <span class="p">=</span> <span class="n">Stub</span><span class="p">.</span><span class="n">Inst</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">stub</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 因后台任务独立运行，存根类型需要从State库获取！</span>
</span></span><span class="line"><span class="cl">            <span class="kt">string</span> <span class="n">tpName</span> <span class="p">=</span> <span class="k">await</span> <span class="n">CookieX</span><span class="p">.</span><span class="n">Get</span><span class="p">(</span><span class="n">_stubType</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">tpName</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">Type</span> <span class="n">tp</span> <span class="p">=</span> <span class="n">Type</span><span class="p">.</span><span class="n">GetType</span><span class="p">(</span><span class="n">tpName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">tp</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">stub</span> <span class="p">=</span> <span class="n">Activator</span><span class="p">.</span><span class="n">CreateInstance</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span> <span class="k">as</span> <span class="n">Stub</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">stub</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Unregister</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">bgJob</span> <span class="p">=</span> <span class="n">stub</span><span class="p">.</span><span class="n">SvcProvider</span><span class="p">.</span><span class="n">GetService</span><span class="p">&lt;</span><span class="n">IBackgroundJob</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">bgJob</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kt">string</span> <span class="n">msg</span> <span class="p">=</span> <span class="s">&#34;启动&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">await</span> <span class="n">bgJob</span><span class="p">.</span><span class="n">Run</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">msg</span> <span class="p">+=</span> <span class="s">&#34; -&gt; 结束&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">msg</span> <span class="p">+=</span> <span class="s">$&#34; -&gt; 运行异常\r\n{ex.Message}&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">WriteLog</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Unregister</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">WriteLog</span><span class="p">(</span><span class="s">&#34;无处理内容，已注销！&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div></p>
<h2 id="资源文件">资源文件</h2>
<p>资源文件是项目中不可缺少的部分，它的生成操作主要有：嵌入的资源、内容、AndroidAsset、BundleResource，这些生成操作可分为两类：</p>
<h3 id="嵌入的资源">嵌入的资源</h3>
<p>“嵌入的资源”是将文件内容嵌入在生成的dll文件中，所有平台用法相同，都是获取嵌入资源的文件流，约定资源文件统一放在项目的Res目录下，如：</p>
<p><img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/5.png" data-srcset="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/5.png, /dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/5.png 1.5x, /dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/5.png 2x" data-sizes="auto" alt="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/5.png" title="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/5.png" width="198" height="243" /></p>
<p>获取嵌入资源的文件流：
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cs" data-lang="cs"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">class</span> <span class="nc">ResKit</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// 返回资源文件流，需要在外部关闭流</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;p_fileName&#34;&gt;文件名，在Res下含子目录时需要添加子目录前缀如：Excel.1040.xlsx&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;exception cref=&#34;Exception&#34;&gt;&lt;/exception&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="n">Stream</span> <span class="n">GetStream</span><span class="p">(</span><span class="kt">string</span> <span class="n">p_fileName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Assembly</span> <span class="n">assembly</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">ResKit</span><span class="p">).</span><span class="n">Assembly</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Stream</span> <span class="n">stream</span> <span class="p">=</span> <span class="n">assembly</span><span class="p">.</span><span class="n">GetManifestResourceStream</span><span class="p">(</span><span class="s">$&#34;Dt.UIDemo.Res.{p_fileName}&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">stream</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="p">(</span><span class="s">&#34;未发现资源文件：&#34;</span> <span class="p">+</span> <span class="n">p_fileName</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">stream</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div></p>
<h3 id="输出内容">输出内容</h3>
<p>另一类是将资源文件打包输出到app的某个目录下，不同平台生成操作不同：</p>
<ul>
<li><code>Content</code>在所有平台都有效，资源文件可以放在任意位置；</li>
<li><code>AndroidAsset</code>只在android有效，并且要求资源文件必须放在<code>Android\Assets</code>目录下，输出目录不包括Android这级，项目目录及apk包内输出目录如下：</li>
</ul>
<p><img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/6.png" data-srcset="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/6.png, /dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/6.png 1.5x, /dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/6.png 2x" data-sizes="auto" alt="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/6.png" title="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/6.png" width="240" height="169" />
<img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/7.png" data-srcset="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/7.png, /dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/7.png 1.5x, /dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/7.png 2x" data-sizes="auto" alt="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/7.png" title="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/7.png" width="366" height="164" /></p>
<ul>
<li><code>BundleResource</code>只在iOS有效，资源文件放在<code>iOS\Resources</code>目录下；</li>
</ul>
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw" aria-hidden="true"></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>统一资源文件的路径：</p>
<ul>
<li>
<p>普通资源文件的生成操作：android为<code>AndroidAsset</code>，iOS为<code>BundleResource</code>，win wasm为<code>Content</code>。约定放在<code>ms-appx:///Assets</code>目录下，这就需要在android项目中资源文件放在<code>Android\Assets\Assets</code>目录下，在iOS项目中资源文件放在<code>iOS\Resources\Assets</code>目录下，在win项目中资源文件放在<code>Assets</code>目录下。一般将实际资源文件放在win项目中的<code>Assets</code>下，其他项目以链接方式引用。</p>
</li>
<li>
<p>图片资源文件的生成操作统一为<code>内容</code>，约定放在<code>ms-appx:///Images</code>目录下，如：<code>&lt;Image Source=&quot;ms-appx:///Images/logo.png&quot; /&gt;</code> 在各平台的文件位置相同，都放在项目的根目录<code>Images</code>下。</p>
</li>
</ul>
</div>
        </div>
    </div>
<h2 id="通讯录">通讯录</h2>
<p>通讯录联系人列表的加载过程</p>
<p><img class="lazyload" src="/dt-docs/svg/loading.min.svg" data-src="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/3.png" data-srcset="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/3.png, /dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/3.png 1.5x, /dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/3.png 2x" data-sizes="auto" alt="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/3.png" title="/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/3.png" width="560" height="868" /></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <section class="post-tags"></section>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://daotingh.gitee.io/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/" data-title="基础"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 百度" data-sharer="baidu" data-url="https://daotingh.gitee.io/dt-docs/docs/3%E5%AE%A2%E6%88%B7%E7%AB%AF/1%E5%9F%BA%E7%A1%80/" data-title="基础"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@6.20.0/icons/baidu.svg" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>
</div>
</article><div class="toc" id="toc-auto">
                <h2 class="toc-title">目录</h2>
                <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#本地存储">本地存储</a></li>
    <li><a href="#当前用户">当前用户</a></li>
    <li><a href="#启动过程">启动过程</a></li>
    <li><a href="#基础选项">基础选项</a></li>
    <li><a href="#提醒与通知">提醒与通知</a></li>
    <li><a href="#后台任务">后台任务</a>
      <ul>
        <li><a href="#windows">Windows</a></li>
        <li><a href="#android">Android</a></li>
        <li><a href="#ios">iOS</a></li>
        <li><a href="#统一后台任务">统一后台任务</a></li>
      </ul>
    </li>
    <li><a href="#资源文件">资源文件</a>
      <ul>
        <li><a href="#嵌入的资源">嵌入的资源</a></li>
        <li><a href="#输出内容">输出内容</a></li>
      </ul>
    </li>
    <li><a href="#通讯录">通讯录</a></li>
  </ul>
</nav></div>
            </div></div>
    </div>
</div>
            </main>
            <footer class="footer">
                <div class="footer-container"><div class="footer-line">搬运工</div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2023 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/dt-docs/" target="_blank">Daoting</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
                </div>
            </footer>
        </div>

        <div id="fixed-buttons">
            <a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a>
            <a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.4.0/css/lightgallery-bundle.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.13.0/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.1/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.4.0/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.4.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.4.0/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":50},"lightgallery":true,"search":{"algoliaAppID":"PASDMWALPK","algoliaIndex":"index.zh-cn","algoliaSearchKey":"b42948e51daaa93df92381c8e2ac0f93","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":30,"type":"algolia"}};</script><script type="text/javascript" src="/dt-docs/js/theme.min.js"></script>
    </body>
</html>
